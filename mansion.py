import random

inventory = []
completed_tasks = set()

levels = {
    1: {
        'description': (
            "Вы находитесь в темном коридоре старого особняка, стены которого обросли паутиной. "
            "Тусклый свет луны пробивается сквозь запыленные окна, создавая зловещие тени. "
            "Слышно, как издалека доносятся странные звуки: шорохи и шепот. "
            "Справа от вас массивная дверь с ржавым замком, а слева — лестница, ведущая вверх. "
            "Чувство тревоги нарастает, но ваша жажда приключений сильнее.\n"
            "Вы решаете: что делать дальше? "
        ),
        'actions': ['открыть дверь', 'подняться по лестнице'],
        'next_levels': {'открыть дверь': 2, 'подняться по лестнице': 3}
    },
    2: {
        'description': (
            "Вы вошли в мрачную комнату, где царит полная тишина. В центре стоит загадочное зеркало, "
            "трескающееся и искрящееся, словно оно скрывает тайну. "
            "Портреты, висящие на стенах, кажутся живыми — их глаза следят за вами с осуждением. "
            "На столе вы находите пожелтевшую записку с надписью: 'Загадка, что отражает, но не имеет формы'. "
            "Вы чувствуете, как дыхание замирает — от разгадки зависит ваша судьба.\n"
            "Что вы будете делать? "
        ),
        'actions': ['разгадать загадку', 'вернуться назад'],
        'puzzle': 'Что отражает, но не имеет формы?',
        'solution': 'зеркало',
        'next_levels': {'разгадать загадку': 4, 'вернуться назад': 1}
    },
    3: {
        'description': (
            "Поднявшись по лестнице, вы оказываетесь на верхнем этаже, где коридоры кажутся бесконечными. "
            "Воздух здесь холоден, а на стенах висят странные тени. "
            "Вдруг вы слышите шорох, и до вашего слуха доходит еле уловимый голос, зовущий вас. "
            "В конце коридора мерцает тусклый свет, вокруг кружат тени. Вам необходимо принять решение: "
            "идти к свету или спуститься вниз, где безопаснее?\n"
            "Что вы выберете? "
        ),
        'actions': ['исследовать шум', 'вернуться вниз'],
        'next_levels': {'исследовать шум': 5, 'вернуться вниз': 1}
    },
    4: {
        'description': (
            "Разгадав загадку, вы чувствуете, как зеркало начинает светиться, наполняясь загадочной энергией. "
            "Из его глубин появляется ключ, сверкающий в темноте, словно он ждал именно вас. "
            "С легким трепетом вы берете его в руки и понимаете, что теперь сможете открыть запертую дверь. "
            "Но будьте осторожны: за этой дверью может скрываться что-то ужасное.\n"
            "Что будете делать дальше? "
        ),
        'actions': ['использовать ключ', 'вернуться назад'],
        'next_levels': {'использовать ключ': 6, 'вернуться назад': 2}
    },
    5: {
        'description': (
            "Вы решили исследовать шум и оказались в зале, где призраки, окутанные туманом, кружат вокруг. "
            "Они шепчут непонятные слова, их лица мрачны и полны печали. Один из них, с бледным лицом, "
            "выглядит особенно интересным, как будто он хочет вам что-то сказать. Вам нужно найти способ "
            "с ними взаимодействовать, чтобы избежать опасности или, возможно, узнать их историю.\n"
            "Как вы поступите? "
        ),
        'actions': ['попытаться поговорить', 'убежать', 'попробовать спрятаться'],
        'next_levels': {'попытаться поговорить': 7, 'убежать': 1, 'попробовать спрятаться': 5}
    },
    6: {
        'description': (
            "Вы открываете дверь и попадаете в сокровищницу, освещенную мерцающим светом. "
            "На полках множество драгоценностей, старинных артефактов и волшебных предметов. "
            "Каждый из них хранит свою историю и тайну. Вы чувствуете, что это не просто золото, "
            "а память о потерянных душах, которые когда-то жили в этом доме. Но нужно быть осторожным: "
            "достать сокровища может привести к непредсказуемым последствиям.\n"
            "Что вы будете делать? "
        ),
        'actions': ['взять сокровища', 'исследовать комнату', 'посмотреть на артефакты'],
        'next_levels': {'взять сокровища': 'win', 'исследовать комнату': 6, 'посмотреть на артефакты': 6}
    },
    7: {
        'description': (
            "Призраки начинают успокаиваться, и один из них, старый хранитель дома, подходит к вам. "
            "Он рассказывает о своей судьбе, о том, как защищал сокровища этого дома и почему он не может покинуть его. "
            "Вы понимаете, что теперь стали новым хранителем этого места. "
            "Хранитель предлагает вам три пути: остаться здесь, стать защитником сокровищ, "
            "попытаться сбежать и оставить всё позади, или спросить его о совете.\n"
            "Что вы решите? "
        ),
        'actions': ['остаться хранителем', 'попытаться сбежать', 'спросить совета'],
        'next_levels': {
            'остаться хранителем': 'win', 
            'попытаться сбежать': 1, 
            'спросить совета': 7
        }
    }
}

def print_inventory():
    if inventory:
        print("Ваш инвентарь:", ', '.join(inventory))
    else:
        print("Ваш инвентарь пуст.")

def game_loop(level):
    while True:
        print(levels[level]['description'])
        print("Доступные действия:", ', '.join(levels[level]['actions']))
        print_inventory()
        
        command = input("Введите действие: ").strip().lower()
        
        if command in levels[level]['next_levels']:
            if command == 'разгадать загадку' and 'ключ' not in inventory:
                answer = input(f"Загадка: {levels[level]['puzzle']} ")
                if answer.lower() == levels[level]['solution']:
                    inventory.append('ключ')
                    print("Вы разгадали загадку и нашли ключ! Теперь вы можете открыть дверь.")
                else:
                    print("Неправильный ответ. Попробуйте еще раз.")
                    continue
            
            next_level = levels[level]['next_levels'][command]
            if next_level == 'win':
                print("Поздравляем! Вы нашли сокровища и стали новым хранителем дома! Ваше приключение только начинается.")
                break
            else:
                level = next_level
        else:
            print("Неверное действие. Попробуйте снова.")

def start_game():
    print("Добро пожаловать в игру 'Призрачный особняк'! Вы — исследователь, который решил разгадать тайны этого мрачного дома.")
    print("Смело входите в его темные коридоры, но будьте осторожны — призраки не любят незваных гостей!")
    print("Ваше приключение начинается сейчас. Приготовьтесь столкнуться с неизведанным!\n")
    game_loop(1)

start_game()
